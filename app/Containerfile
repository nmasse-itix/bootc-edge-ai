FROM quay.io/nmasse-redhat/jetpack-multiarch:r36.4.0

ADD *.py *.jpg *.onnx /opt/app
WORKDIR /opt/app
RUN <<EOF
set -Eeu

# Tell dpkg-configure to avoid asking questions...
export DEBIAN_FRONTEND=noninteractive

# No caching
export PIP_NO_CACHE_DIR=1

# Install git + pip
apt update
apt install -y git python3-pip
rm -rf /var/lib/apt/lists/*
apt-get clean

# Install Python dependencies
pip3 install -y onnxruntime_gpu
pip3 install -r requirements.txt
EOF

ENTRYPOINT [ "python3", "app.py" ]
CMD [ ]
